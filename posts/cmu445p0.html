<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CUM15-445-P0 C++ Primer | AriesfunのBlog</title><meta name="keywords" content="C/C++,学习记录,LAB学习,数据库内核"><meta name="author" content="Ariesfun"><meta name="copyright" content="Ariesfun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[CUM15-445] P0 C++ Primer【文档 p0-lab详情地址】  Task#1 Copy-On-Write Trie要求In this task, you will need to modify trie.h and trie.cpp to implement a copy-on-write trie. In a copy-on-write trie, operations do">
<meta property="og:type" content="article">
<meta property="og:title" content="CUM15-445-P0 C++ Primer">
<meta property="og:url" content="https://ariesfun.gitee.io/posts/cmu445p0.html">
<meta property="og:site_name" content="AriesfunのBlog">
<meta property="og:description" content="[CUM15-445] P0 C++ Primer【文档 p0-lab详情地址】  Task#1 Copy-On-Write Trie要求In this task, you will need to modify trie.h and trie.cpp to implement a copy-on-write trie. In a copy-on-write trie, operations do">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png">
<meta property="article:published_time" content="2023-08-27T04:03:40.136Z">
<meta property="article:modified_time" content="2023-08-27T04:31:01.395Z">
<meta property="article:author" content="Ariesfun">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="学习记录">
<meta property="article:tag" content="LAB学习">
<meta property="article:tag" content="数据库内核">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png"><link rel="shortcut icon" href="/img/logo_22.png"><link rel="canonical" href="https://ariesfun.gitee.io/posts/cmu445p0"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Ariesfun","link":"链接: ","source":"来源: AriesfunのBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CUM15-445-P0 C++ Primer',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-27 12:31:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/gradient_background.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="AriesfunのBlog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-dark.css" type="text/css"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/logo_22.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于作者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">AriesfunのBlog</a></span><div id="he-plugin-simple"></div><div id="none_space"></div><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于作者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CUM15-445-P0 C++ Primer</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-27T04:03:40.136Z" title="发表于 2023-08-27 12:03:40">2023-08-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-27T04:31:01.395Z" title="更新于 2023-08-27 12:31:01">2023-08-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CMU15-445/">CMU15-445</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CUM15-445-P0 C++ Primer"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="CUM15-445-P0-C-Primer"><a href="#CUM15-445-P0-C-Primer" class="headerlink" title="[CUM15-445] P0 C++ Primer"></a>[CUM15-445] P0 C++ Primer</h2><p><a target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/spring2023/project0/">【文档 p0-lab详情地址】</a></p>
<hr>
<h3 id="Task-1-Copy-On-Write-Trie"><a href="#Task-1-Copy-On-Write-Trie" class="headerlink" title="Task#1 Copy-On-Write Trie"></a>Task#1 Copy-On-Write Trie</h3><h4 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h4><p>In this task, you will need to modify <code>trie.h</code> and <code>trie.cpp</code> to implement a copy-on-write trie. In a copy-on-write trie, operations do not directly modify the nodes of the original trie. Instead, new nodes are created for modified data, and a new root is returned for the newly-modified trie. Copy-on-write enables us to access the trie after each operation at any time with minimum overhead(最小开销). Consider inserting <code>(&quot;ad&quot;, 2)</code> in the above example. We create a new <code>Node2</code> by reusing two of the child nodes from the original tree, and creating a new value node 2. (See figure below)</p>
<p>If we then insert <code>(&quot;b&quot;, 3)</code>, we will create a new root, a new node and reuse the previous nodes. In this way, we can get the content of the trie before and after each insertion operation. As long as we have the root object (<code>Trie</code> class), we can access the data inside the trie at that time. (See figure below)</p>
<p>One more example: if we then insert <code>(&quot;a&quot;, &quot;abc&quot;)</code> and remove <code>(&quot;ab&quot;, 1)</code>, we can get the below trie. Note that parent nodes can have values, and you will need to purge all unnecessary nodes after removal.</p>
<p>Your trie should support 3 operations:</p>
<ul>
<li><code>Get(key)</code>: Get the value corresponding to the key.</li>
<li><code>Put(key, value)</code>: Set the corresponding value to the key. Overwrite existing value if the key already exists. <strong>Note that the type of the value might be non-copyable</strong> (i.e., <code>std::unique_ptr</code>). This method returns a new trie.</li>
<li><code>Delete(key)</code>: Delete the value for the key. This method returns a new trie.</li>
</ul>
<p>None of these operations should be performed directly on the trie itself. </p>
<p>You should create new trie nodes and reuse existing ones as much as possible. <strong>// 创建新的trie节点并尽可能重用现有节点。</strong></p>
<p>To create a new node, you should use the <code>Clone</code> function on the <code>TrieNode</code> class. To reuse an existing node in the new trie, you can copy <code>std::shared_ptr</code>: copying a shared pointer doesn’t copy the underlying data. You should not manually allocate memory by using <code>new</code> and <code>delete</code> in this project. <code>std::shared_ptr</code> will deallocate the object when no one has a reference to the underlying object.</p>
<p>For the full specifications of these operations, please refer to the comments in the starter code.</p>
<hr>
<h4 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h4><p>任务要求我们实现一个写时复制树，并且补充完成插入、查询、删除的操作</p>
<p>01.<code>PUT()</code><strong>插入操作</strong>，</p>
<p>每次放入一对 <code>(key, value)</code></p>
<p>插入的Trie节点分为两种：(<code>TrieNode</code>和<code>TrieNodeWithValue&lt;T&gt;</code>)</p>
<p>Trie类成员变量：<code>root_</code></p>
<p>类关系图如下，<code>std::shared_ptr</code>是共享指针可以直接复制，</p>
<img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230824103333232.png" alt="image-20230824103333232" style="zoom:67%;" />

<p><strong>考虑边界情况：</strong></p>
<ul>
<li>插入时是空树</li>
<li>插入时key是空串</li>
</ul>
<p><strong>遍历key,构建一个由key字符路径组成的字典树:</strong></p>
<p>只遍历到倒数第二个字符，</p>
<ul>
<li><p>依次判断字符对应的孩子节点是否存在</p>
<p>1.不存在，就新建一个普通节点</p>
<p>2.存在，就使用<code>Clone</code>拷贝原有分支，让新树对应的指针指向拷贝分支</p>
</li>
</ul>
<p>特殊处理最后一个字符，</p>
<ul>
<li>最后字符对应的节点不存在，需要创建一个无孩子的数值节点</li>
<li>存在对应节点的那个分支，需要覆盖原有数值节点的内容，并且保留对应孩子节点</li>
</ul>
<p>最后返回Trie的根节点</p>
<p><strong>处理的流程图如下，</strong></p>
<p><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230824165749379.png" alt="image-20230824165749379"></p>
<p>02.<code>Get()</code><strong>查询操作</strong></p>
<p><strong>考虑边界情况:</strong></p>
<p>查询到的是空树时，返回空</p>
<p><strong>使用临时指针遍历查询的key:</strong></p>
<p>看能否在Trie的分支中找到对应的字符节点，</p>
<ul>
<li>某个字符不能找到，返回空树</li>
<li>都能找到，指针会指向key的尾节点，需要继续判断</li>
</ul>
<p>当前节点是否为<code>is_value_node_</code>这个终止节点，</p>
<ul>
<li><p>为<code>false</code>，说明该节点为普通节点，返回空树</p>
</li>
<li><p>为<code>true</code>，说明是有对应的数值节点，那就返回对应节点的裸指针</p>
</li>
</ul>
<p><strong>处理流程如下，</strong></p>
<p><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230824164321951.png" alt="image-20230824164321951"></p>
<p>03.<code>Remove()</code><strong>删除/移除操作</strong></p>
<p><strong>删除对应节点的值时，不能影响原有节点，操作都在新节点上执行</strong></p>
<p><strong>具体的思路，</strong></p>
<p><strong>自顶向下，从根节点开始遍历串key，采用DFS递归处理，每次记录递归的串下标</strong></p>
<p><strong>边界考虑（递归出口）:</strong></p>
<p><strong>处理叶子结点，遍历到最后一个字符，找到要删除的节点时</strong></p>
<ul>
<li><p>当前节点已经没有孩子，返回空</p>
</li>
<li><p>有孩子节点，新建一个普通节点（并且根据孩子节点来构造）</p>
<p><u>为普通节点时就相当于只把当前节点的值置空了（达到删除目的）</u></p>
</li>
</ul>
<p><strong>处理中间节点：</strong></p>
<p>当前遍历到的字符，可以在当前节点的孩子节点中找到时，</p>
<ul>
<li><p>就递归到下一层,并返回对应的孩子节点</p>
</li>
<li><p>每次拷贝当前节点的分支             </p>
<p>递归有返回值且不空—&gt;说明孩子节点存在，连接到新分支对应位置处</p>
<p>递归返回的节点为空—&gt;到查找字符路径的最后一个位置了，继续判断</p>
<ul>
<li><p>当前节点是数值节点，就可删除对应位置的节点（已经是字符路径的最后一个位置，就可删掉），变为普通节点</p>
</li>
<li><p>当前节点是普通节点且没有孩子时，返回空（理解为置空操作）</p>
</li>
</ul>
</li>
<li><p>每层返回拷贝后经修改后的节点</p>
</li>
</ul>
<p>如果键的下一个字符不存在于当前节点的孩子中，就没找到直接返回原节点<code>root</code>。</p>
<p><strong>处理流程图如下，</strong></p>
<p><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230824164105191.png" alt="image-20230824164105191"></p>
<p><strong>结合Chatgpt辅助理解，节点删除的过程</strong></p>
<p>做出声明，当删除的节点已经是尾节点时，直接删掉这个数值节点，父节点的状态不变无需更新。</p>
<img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230824121933506.png" alt="image-20230824121933506" style="zoom: 67%;" />

<hr>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>balabala…</p>
<hr>
<h3 id="Task-2-Concurrent-Key-Value-Store"><a href="#Task-2-Concurrent-Key-Value-Store" class="headerlink" title="Task#2 Concurrent Key-Value Store"></a>Task#2 Concurrent Key-Value Store</h3><h4 id="要求-1"><a href="#要求-1" class="headerlink" title="要求"></a>要求</h4><p>Task #2 - Concurrent Key-Value Store</p>
<p>After you have a copy-on-write trie which can be used in a single-thread environment, implement a concurrent key-value store for a multithreaded environment. In this task, you will need to modify <code>trie_store.h</code> and <code>trie_store.cpp</code>. This key-value store also supports 3 operations:</p>
<ul>
<li><code>Get(key)</code> returns the value.</li>
<li><code>Put(key, value)</code>. No return value.</li>
<li><code>Remove(key)</code>. No return value.</li>
</ul>
<p>For the original Trie class, everytime we modify the trie, we need to get the new root to access the new content. But for the concurrent key-value store, the <code>put</code> and <code>delete</code> methods do not have a return value. This requires you to use concurrency primitives to synchronize reads and writes so that no data is lost through the process.</p>
<p>Your concurrent key-value store should concurrently serve multiple readers <em>and</em> a single writer. <strong>// 多个读者，一个写者</strong></p>
<p>That is to say, when someone is modifying the trie, reads can still be performed on the old root. When someone is reading, writes can still be performed without waiting for reads. <strong>// 当有人修改trie时，仍然可以在旧根上读取。当有人正在读取时，仍然可以执行写入，而无需等待读取。</strong></p>
<p>Also, if we get a reference to a value from the trie, we should be able to access it no matter how we modify the trie. The <code>Get</code> function from <code>Trie</code> only returns a pointer. If the trie node storing this value has been removed, the pointer will be dangling. Therefore, in <code>TrieStore</code>, we return a <code>ValueGuard</code> which stores both a reference to the value and the TrieNode corresponding to the root of the trie structure, so that the value can be accessed as we store the <code>ValueGuard</code>.</p>
<p>To achieve this, we have provided you with the pseudo code for <code>TrieStore::Get</code> in <code>trie_store.cpp</code>. Please read it carefully and think of how to implement <code>TrieStore::Put</code> and <code>TrieStore::Remove</code>.</p>
<h4 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h4><ul>
<li>并发访问将写时复制的多版本字典树，简化为两个版本，<strong>历史版本和当前版本。</strong></li>
<li>并发访问时，只有一个根节点，始终保存最新的数据。</li>
<li>并发控制原则：<strong>共享读、排他写</strong></li>
</ul>
<h4 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h4><p>根据伪代码的提示信息，</p>
<p>在多线程环境下，通过对根节点进行加锁或解锁操作，来实现并发键值存储</p>
<p><code>01.Get()</code></p>
<p>值得注意的是，在进行查找trie树节点时，我们<strong>拿到根节点后需要立即解锁</strong></p>
<p>原因是，<u>写时复制字典树，会保留历史版本信息，读的时候并不会受新Trie修改的影响（可以保证有多个读者）</u></p>
<p><code>02.Put()</code></p>
<p>插入Tire树的节点信息时，需要加读锁，确保此刻只有一个对象来进行修改操作。</p>
<p>插入完成后，同时要将新修改的信息拷贝给Trie的成员变量<code>root_</code>,让其持有最新的信息</p>
<p><code>03.Remove()</code></p>
<p>操作类似Put过程</p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p>balabala…</p>
<hr>
<h3 id="Task-3-Debugging"><a href="#Task-3-Debugging" class="headerlink" title="Task#3 Debugging"></a>Task#3 Debugging</h3><h4 id="要求-2"><a href="#要求-2" class="headerlink" title="要求"></a>要求</h4><p>In this task, you will learn the basic techniques of debugging. You can choose any way you prefer for debugging, including but not limited to: using <code>cout</code> and <code>printf</code>, using CLion / VSCode debugger, using gdb, etc.</p>
<p>Please refer to <code>trie_debug_test.cpp</code> for instructions. You will need to set a breakpoint after the trie structure is generated and answer a few questions. You will need to fill in the answer in <code>trie_answer.h</code>.</p>
<h4 id="使用Clion进行Debug"><a href="#使用Clion进行Debug" class="headerlink" title="使用Clion进行Debug"></a>使用Clion进行Debug</h4><p>这步要求我们在 <code>trie_debug_test.cpp</code> 进行Debug测试，通过debug信息得到题目要求的答案内容，</p>
<p>我使用Clion进行Debug测试后，三个答案的结果是<code>8 1 42</code>, 进行测试后答案并不对。</p>
<h4 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h4><p>网上转了一圈发现别人也有类似的问题，通过修改为指定的测试样例，是可以解决的,替换TrieDebugger的内容如下，</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> trie = <span class="built_in">Trie</span>();</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;65&quot;</span>, <span class="number">25</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;61&quot;</span>, <span class="number">65</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;82&quot;</span>, <span class="number">84</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;2&quot;</span>, <span class="number">42</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;16&quot;</span>, <span class="number">67</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;94&quot;</span>, <span class="number">53</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;20&quot;</span>, <span class="number">35</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;3&quot;</span>, <span class="number">57</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;93&quot;</span>, <span class="number">30</span>);</span><br><span class="line">trie = trie.<span class="built_in">Put</span>&lt;<span class="type">uint32_t</span>&gt;(<span class="string">&quot;75&quot;</span>, <span class="number">29</span>);</span><br></pre></td></tr></table></figure>

<p>参考的解决方案：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/613920859">【文档 CMU15-445 Project 0 (Spring 2023)】</a></p>
<p><strong>需要注意：</strong></p>
<p>修改测试样例后，Debug后的答案是<code>7 2 30</code>，用<code>gtest</code>进行单测后还是不正确，<strong>这是没问题的，提交到评测网站上是可以通过的</strong>。</p>
<hr>
<h3 id="Task-4-SQL-String-Functions"><a href="#Task-4-SQL-String-Functions" class="headerlink" title="Task#4 SQL String Functions"></a>Task#4 SQL String Functions</h3><h4 id="要求-3"><a href="#要求-3" class="headerlink" title="要求"></a>要求</h4><p>Now it is time to dive into BusTub itself! You will need to implement <code>upper</code> and <code>lower</code> SQL functions. </p>
<p>This can be done in 2 steps: </p>
<p>(1) implement the function logic in <code>string_expression.h</code>. <strong>// 实现大小写的转换的逻辑函数</strong></p>
<p>(2) register the function in BusTub, so that the SQL framework can call your function when the user executes a SQL, in <code>plan_func_call.cpp</code>. <strong>// 在BusTub中实现注册函数，以便SQL框架可以在用户执行SQL时调用该函数</strong></p>
<h4 id="实现思路-2"><a href="#实现思路-2" class="headerlink" title="实现思路"></a>实现思路</h4><p><code>string_expression.h</code></p>
<p>执行SOL时，通过判断<code>expr_type_</code>的转换类型，使用<code>tolower()</code>和<code>toupper()</code>对传入的字符串进行处理</p>
<p><code>plan_func_call.cpp</code></p>
<p>检验参数的合法性，进行注册操作，按照伪代码提示完成。</p>
<hr>
<h4 id="拓展知识点"><a href="#拓展知识点" class="headerlink" title="拓展知识点"></a>拓展知识点</h4><p>SQL层调用链路框架图，</p>
<ol>
<li><strong>Bustub模块图</strong></li>
</ol>
<img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230825085923699.png" alt="image-20230825085923699" style="zoom: 50%;" />



<p><strong>Bustub调用链（到SQL层）</strong></p>
<p><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230825090159651.png" alt="image-20230825090159651"></p>
<p>通过Debug，可以看到函数的调用栈  </p>
<p>执行shell, 启动bustub  </p>
<p>输入<code>select upper(&#39;AbCd&#39;), lower(&#39;AbCd&#39;);</code>来执行查询操作  <img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230825085717023.png" alt="image-20230825085717023"></p>
<hr>
<h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><p>balabala…</p>
<hr>
<h3 id="代码提交评测"><a href="#代码提交评测" class="headerlink" title="代码提交评测"></a>代码提交评测</h3><p><a target="_blank" rel="noopener" href="https://www.gradescope.com/courses/500628">【官方评测工具 代码评测地址】</a></p>
<img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230825103908981.png" alt="image-20230825103908981" style="zoom: 50%;" />

<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://ariesfun.gitee.io">Ariesfun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ariesfun.gitee.io/posts/cmu445p0.html">https://ariesfun.gitee.io/posts/cmu445p0.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ariesfun.gitee.io" target="_blank">AriesfunのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C-C/">C/C++</a><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">学习记录</a><a class="post-meta__tags" href="/tags/LAB%E5%AD%A6%E4%B9%A0/">LAB学习</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8/">数据库内核</a></div><div class="post_share"><div class="social-share" data-image="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/cmu445p1.html"><img class="prev-cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CUM15-445-P1 Buffer Pool Manager</div></div></a></div><div class="next-post pull-right"><a href="/posts/cmu15445.html"><img class="next-cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CUM 15-445 2023-Spring Lab记录合集</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/cmu445p1.html" title="CUM15-445-P1 Buffer Pool Manager"><img class="cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-27</div><div class="title">CUM15-445-P1 Buffer Pool Manager</div></div></a></div><div><a href="/posts/cmu15445.html" title="CUM 15-445 2023-Spring Lab记录合集"><img class="cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-27</div><div class="title">CUM 15-445 2023-Spring Lab记录合集</div></div></a></div><div><a href="/posts/acf5.html" title="C++11 多线程编程基础(下)"><img class="cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/multi_thread_002.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-05</div><div class="title">C++11 多线程编程基础(下)</div></div></a></div><div><a href="/posts/3cf4.html" title="C++11 多线程编程基础(上)"><img class="cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/multi_thread_001.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-05</div><div class="title">C++11 多线程编程基础(上)</div></div></a></div><div><a href="/posts/21e5.html" title="C++ 设计模式(单例+工厂)"><img class="cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/202308090027619.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-09</div><div class="title">C++ 设计模式(单例+工厂)</div></div></a></div><div><a href="/posts/6d6b.html" title="C&#x2F;C++ 内存四区总结"><img class="cover" src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/202308090026441.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-09</div><div class="title">C&#x2F;C++ 内存四区总结</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/logo_22.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ariesfun</div><div class="author-info__description">这里有互联网技术分享、计算机专业知识学习和生活日志...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ariesfun"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2018351840&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://space.bilibili.com/172382106" target="_blank" title="Bilibili"><i class="fab fa-bilibili"></i></a><a class="social-icon" href="mailto:ariesfun2019@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://github.com/ariesfun" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一些资源共享: (仅限校友内网访问)
http://10.200.21.35:8100/s/WJhg
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CUM15-445-P0-C-Primer"><span class="toc-text">[CUM15-445] P0 C++ Primer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-Copy-On-Write-Trie"><span class="toc-text">Task#1 Copy-On-Write Trie</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%81%E6%B1%82"><span class="toc-text">要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-Concurrent-Key-Value-Store"><span class="toc-text">Task#2 Concurrent Key-Value Store</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-1"><span class="toc-text">要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text">相关知识点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-1"><span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-3-Debugging"><span class="toc-text">Task#3 Debugging</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-2"><span class="toc-text">要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Clion%E8%BF%9B%E8%A1%8CDebug"><span class="toc-text">使用Clion进行Debug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-text">问题解决</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-4-SQL-String-Functions"><span class="toc-text">Task#4 SQL String Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%81%E6%B1%82-3"><span class="toc-text">要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-2"><span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text">拓展知识点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-2"><span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4%E8%AF%84%E6%B5%8B"><span class="toc-text">代码提交评测</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/acf5.html" title="C++11 多线程编程基础(下)"><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/multi_thread_002.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++11 多线程编程基础(下)"/></a><div class="content"><a class="title" href="/posts/acf5.html" title="C++11 多线程编程基础(下)">C++11 多线程编程基础(下)</a><time datetime="2023-09-04T17:56:56.639Z" title="发表于 2023-09-05 01:56:56">2023-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3cf4.html" title="C++11 多线程编程基础(上)"><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/multi_thread_001.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++11 多线程编程基础(上)"/></a><div class="content"><a class="title" href="/posts/3cf4.html" title="C++11 多线程编程基础(上)">C++11 多线程编程基础(上)</a><time datetime="2023-09-04T17:56:56.526Z" title="发表于 2023-09-05 01:56:56">2023-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cmu445p1.html" title="CUM15-445-P1 Buffer Pool Manager"><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CUM15-445-P1 Buffer Pool Manager"/></a><div class="content"><a class="title" href="/posts/cmu445p1.html" title="CUM15-445-P1 Buffer Pool Manager">CUM15-445-P1 Buffer Pool Manager</a><time datetime="2023-08-27T04:03:59.249Z" title="发表于 2023-08-27 12:03:59">2023-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cmu445p0.html" title="CUM15-445-P0 C++ Primer"><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CUM15-445-P0 C++ Primer"/></a><div class="content"><a class="title" href="/posts/cmu445p0.html" title="CUM15-445-P0 C++ Primer">CUM15-445-P0 C++ Primer</a><time datetime="2023-08-27T04:03:40.136Z" title="发表于 2023-08-27 12:03:40">2023-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cmu15445.html" title="CUM 15-445 2023-Spring Lab记录合集"><img src="https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CUM 15-445 2023-Spring Lab记录合集"/></a><div class="content"><a class="title" href="/posts/cmu15445.html" title="CUM 15-445 2023-Spring Lab记录合集">CUM 15-445 2023-Spring Lab记录合集</a><time datetime="2023-08-27T03:47:38.888Z" title="发表于 2023-08-27 11:47:38">2023-08-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://imgbed-funblog.oss-cn-chengdu.aliyuncs.com/img/image-20230827120007265.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Ariesfun</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-teal-two.vercel.app',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-teal-two.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="/js/weather.js"></script> <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>